BASE_BOX_IMAGE = "ubuntu/jammy64"
CPUS_CONTROLLER = 2
MEMORY_CONTROLLER = 4096
CPUS_COMPUTE = 2
MEMORY_COMPUTE = 2048
# Change to increase the number of COMPUTEs
COMPUTE_NODE_COUNT = 1

Vagrant.configure("2") do |config|
  config.vm.provision "shell", path: "controller.sh"
  # CONTROLLER node

  config.vm.define "controller" do |controller|
    controller.vm.box = BASE_BOX_IMAGE
    # controller.vm.hostname = "controller.example.com"
    controller.vm.network "private_network", ip: "192.168.56.254"
    controller.vm.network "private_network", ip: "10.200.0.254"
    # controller.vm.network "private_network", :name => 'NatNetwork' , ip: "10.0.2.254"
    controller.vm.network "forwarded_port", guest: 5000, host: 5000
    controller.vm.provider "virtualbox" do |vb|
      vb.name = "controller"
      vb.cpus = CPUS_CONTROLLER
      vb.memory = MEMORY_CONTROLLER
      vb.customize ["modifyvm", :id, "--nat-network3", "NatNetwork"]
    end

    # controller.vm.provision "shell", path: "controller.sh"
  end

    # COMPUTE node

    (1..COMPUTE_NODE_COUNT).each do |i|
      config.vm.define "compute#{i}" do |compute|
        compute.vm.box = BASE_BOX_IMAGE
        compute.vm.hostname = "compute#{i}.example.com"
        compute.vm.network "private_network", ip: "192.168.56.11#{i}"    
        compute.vm.network "private_network", ip: "10.200.0.11#{i}"
        # compute.vm.network "private_network", :name => 'NatNetwork' , ip: "10.0.2.1#{i}"
        compute.vm.provider "virtualbox" do |vb|
          vb.name = "compute#{i}"
          vb.cpus = CPUS_COMPUTE
          vb.memory = MEMORY_COMPUTE
          vb.customize ["modifyvm", :id, "--nat-network3", "NatNetwork"]
        end
        # compute.vm.provision "shell", path: "compute.sh"
      end
  end
end
